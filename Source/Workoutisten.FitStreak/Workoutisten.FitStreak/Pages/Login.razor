@using Workoutisten.FitStreak.Data.Models.User

@page "/login"

@inject NavigationManager _NavigationManager
@inject IRestClient _RestClient
@inject IConverterWrapper _Converter
@inject CustomAuthenticationStateProvider _AuthenticationStateProvider

<MudStack>
    <MudStack AlignItems="AlignItems.Center">
        <MudImage Class="align-center" Src="Images/fitstreak_logo_white.svg" Width="300" Height="100"></MudImage>
    </MudStack>
    <MudPaper Class="rounded-xl p-4 mt-5" Elevation="5">
        <MudText Class="align-center" Typo="Typo.h4"><b>Login</b></MudText>
        <MudDivider/>
        <MudStack Spacing="3">
            <MudItem xs=12>
                <MudTextField @bind-Value="@loginModel.Email" Label="Email" Variant="Variant.Text" Clearable="true" />
            </MudItem>
            <MudItem xs=12>
                <MudTextField @bind-Value="@loginModel.Password" Label="Password" Variant="Variant.Text" Clearable="true" />
            </MudItem>
            <MudDivider/>
            <FitStreakButton Label="Login" OnClick="Login_Button"/>
            <MudText Typo="Typo.subtitle1">@message</MudText>
        </MudStack>
    </MudPaper>
</MudStack>

@code {
    public LoginModel loginModel { get; set; } = new LoginModel();
    string message = string.Empty;

    async void Login_Button()
    {
        message = "Logging in...";
        var response = await _RestClient.LoginAsync(await _Converter.ToDto<LoginModel, AuthenticationRequest>(loginModel));
        if (response != null)
        {
            message = "Success";
            await _AuthenticationStateProvider.Login(response.Jwt);
            _NavigationManager.NavigateTo("/home");
        }
        else
        {
            message = "Login Error!";
        }
    }
}
